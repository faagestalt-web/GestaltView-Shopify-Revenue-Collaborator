{
  "version": 3,
  "sources": ["../src/cli/commands/auth/login.ts", "../../cli-kit/src/public/node/session-prompt.ts"],
  "sourcesContent": ["import Command from '@shopify/cli-kit/node/base-command'\nimport {promptSessionSelect} from '@shopify/cli-kit/node/session-prompt'\nimport {Flags} from '@oclif/core'\nimport {outputCompleted} from '@shopify/cli-kit/node/output'\n\nexport default class Login extends Command {\n  static description = 'Logs you in to your Shopify account.'\n\n  static flags = {\n    alias: Flags.string({\n      description: 'Alias of the session you want to login to.',\n      env: 'SHOPIFY_FLAG_AUTH_ALIAS',\n    }),\n  }\n\n  async run(): Promise<void> {\n    const {flags} = await this.parse(Login)\n    const result = await promptSessionSelect(flags.alias)\n    outputCompleted(`Current account: ${result}.`)\n  }\n}\n", "import {renderSelectPrompt} from './ui.js'\nimport {ensureAuthenticatedUser} from './session.js'\nimport {identityFqdn} from './context/fqdn.js'\nimport * as sessionStore from '../../private/node/session/store.js'\nimport {setCurrentSessionId} from '../../private/node/conf-store.js'\nimport type {Sessions} from '../../private/node/session/schema.js'\n\nconst NEW_LOGIN_VALUE = 'NEW_LOGIN'\n\ninterface SessionChoice {\n  label: string\n  value: string\n}\n\n/**\n * Builds the choices array from existing sessions.\n *\n * @param sessions - The sessions object from storage.\n * @param fqdn - The identity provider FQDN.\n * @returns Array of session choices.\n */\nfunction buildSessionChoices(sessions: Sessions, fqdn: string): SessionChoice[] {\n  const choices: SessionChoice[] = []\n  const fqdnSessions = sessions[fqdn]\n\n  if (fqdnSessions) {\n    for (const [userId, session] of Object.entries(fqdnSessions)) {\n      choices.push({\n        label: session.identity.alias ?? userId,\n        value: userId,\n      })\n    }\n  }\n\n  return choices\n}\n\n/**\n * Handles the new login flow.\n *\n * @returns The alias of the authenticated user.\n */\nasync function handleNewLogin(): Promise<string> {\n  const result = await ensureAuthenticatedUser({}, {forceNewSession: true})\n  const alias = await sessionStore.getSessionAlias(result.userId)\n  return alias ?? result.userId\n}\n\n/**\n * Gets all available session choices including the \"new login\" option.\n *\n * @returns Array of session choices.\n */\nasync function getAllChoices(): Promise<SessionChoice[]> {\n  const sessions = await sessionStore.fetch()\n  const fqdn = await identityFqdn()\n  const choices: SessionChoice[] = []\n\n  if (sessions) {\n    choices.push(...buildSessionChoices(sessions, fqdn))\n  }\n\n  if (choices.length > 0) {\n    choices.push({\n      label: 'Log in with a different account',\n      value: NEW_LOGIN_VALUE,\n    })\n  }\n\n  return choices\n}\n\n/**\n * Prompts the user to select from existing sessions or log in with a different account.\n *\n * - If alias is provided, tries to switch to that session directly\n * - Otherwise, shows a prompt with all available sessions and the option to log in with a different account.\n *\n * @param alias - Optional alias of the account to switch to.\n * @returns Promise with the alias of the chosen session.\n */\nexport async function promptSessionSelect(alias?: string): Promise<string> {\n  if (alias) {\n    const userId = await sessionStore.findSessionByAlias(alias)\n    if (userId) {\n      setCurrentSessionId(userId)\n      return alias\n    }\n  }\n\n  const choices = await getAllChoices()\n  let selectedValue = NEW_LOGIN_VALUE\n\n  if (choices.length > 0) {\n    const message = 'Which account would you like to use?'\n    selectedValue = await renderSelectPrompt({message, choices})\n  }\n\n  if (selectedValue === NEW_LOGIN_VALUE) {\n    return handleNewLogin()\n  }\n\n  setCurrentSessionId(selectedValue)\n  return choices.find((choice) => choice.value === selectedValue)?.label ?? selectedValue\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;ACAA;AAOA,IAAM,kBAAkB;AAcxB,SAAS,oBAAoB,UAAoB,MAAY;AAC3D,MAAM,UAA2B,CAAA,GAC3B,eAAe,SAAS,IAAI;AAElC,MAAI;AACF,aAAW,CAAC,QAAQ,OAAO,KAAK,OAAO,QAAQ,YAAY;AACzD,cAAQ,KAAK;QACX,OAAO,QAAQ,SAAS,SAAS;QACjC,OAAO;OACR;AAIL,SAAO;AACT;AAOA,eAAe,iBAAc;AAC3B,MAAM,SAAS,MAAM,wBAAwB,CAAA,GAAI,EAAC,iBAAiB,GAAI,CAAC;AAExE,SADc,MAAmB,gBAAgB,OAAO,MAAM,KAC9C,OAAO;AACzB;AAOA,eAAe,gBAAa;AAC1B,MAAM,WAAW,MAAmB,MAAK,GACnC,OAAO,MAAM,aAAY,GACzB,UAA2B,CAAA;AAEjC,SAAI,YACF,QAAQ,KAAK,GAAG,oBAAoB,UAAU,IAAI,CAAC,GAGjD,QAAQ,SAAS,KACnB,QAAQ,KAAK;IACX,OAAO;IACP,OAAO;GACR,GAGI;AACT;AAWA,eAAsB,oBAAoB,OAAc;AACtD,MAAI,OAAO;AACT,QAAM,SAAS,MAAmB,mBAAmB,KAAK;AAC1D,QAAI;AACF,iCAAoB,MAAM,GACnB;EAEX;AAEA,MAAM,UAAU,MAAM,cAAa,GAC/B,gBAAgB;AAOpB,SALI,QAAQ,SAAS,MAEnB,gBAAgB,MAAM,mBAAmB,EAAC,SAD1B,wCACmC,QAAO,CAAC,IAGzD,kBAAkB,kBACb,eAAc,KAGvB,oBAAoB,aAAa,GAC1B,QAAQ,KAAK,CAAC,WAAW,OAAO,UAAU,aAAa,GAAG,SAAS;AAC5E;;;ADtGA,kBAAoB;AAGpB,IAAqB,QAArB,MAAqB,eAAc,qBAAQ;AAAA,EACzC;AAAA,SAAO,cAAc;AAAA;AAAA,EAErB;AAAA,SAAO,QAAQ;AAAA,MACb,OAAO,kBAAM,OAAO;AAAA,QAClB,aAAa;AAAA,QACb,KAAK;AAAA,MACP,CAAC;AAAA,IACH;AAAA;AAAA,EAEA,MAAM,MAAqB;AACzB,QAAM,EAAC,MAAK,IAAI,MAAM,KAAK,MAAM,MAAK,GAChC,SAAS,MAAM,oBAAoB,MAAM,KAAK;AACpD,oBAAgB,oBAAoB,MAAM,GAAG;AAAA,EAC/C;AACF;",
  "names": []
}
